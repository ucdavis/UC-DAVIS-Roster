let inputConfig = input.config();
console.log("Received input:", inputConfig);

// Extract student data arrays from the webhook payload
let firstNames = inputConfig.firstName || [];
let lastNames = inputConfig.lastName || [];
let emails = inputConfig['Work E-mail Address'] || []; // Adjusted field name to match webhook payload

console.log("First Names:", firstNames);
console.log("Last Names:", lastNames);
console.log("Emails:", emails);

// Extract course details (these will be the same for all students)
let courseName = inputConfig.courseName;
let agency = inputConfig.agency;
let instructor = inputConfig.instructor;
let sectionNumber = inputConfig.sectionNumber;
let date = inputConfig.date;
let courseHours = inputConfig.courseHours;

// Ensure that the arrays are properly filled
if (firstNames.length === 0 || lastNames.length === 0 || emails.length === 0) {
    throw new Error("Student data is missing.");
}

// Ensure that all arrays have the same length
if (firstNames.length !== lastNames.length || firstNames.length !== emails.length) {
    throw new Error("Mismatched array lengths: firstName, lastName, and email arrays must have the same number of elements.");
}

// Reference the table where you want to insert the student records
let table = base.getTable('daily attendance');

// Loop through the student data and create individual rows
for (let i = 0; i < firstNames.length; i++) {
    await table.createRecordAsync({
        'First Name': firstNames[i],
        'Last Name': lastNames[i],
        'Work E-mail Address': emails[i], // Ensure this matches the field name in your Airtable base
        'Course Name': courseName,
        'Agency': agency,
        'Instructor': instructor,
        'Date': date,
        'Section Number': sectionNumber,
        'Course Hours': courseHours
    });
}
